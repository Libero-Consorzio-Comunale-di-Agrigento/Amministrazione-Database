<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">

    <changeSet id="201909251231" author="snegroni">
        <comment>Creazione job per pulizia eventi</comment>
            <sql dbms="oracle"
                 endDelimiter="\"
                 splitStatements="true"
                 stripComments="true">
                    declare
                    d_job number;
                    v_esiste number;
                    begin
                    select count(*)
                    into v_esiste
                    from user_jobs usjo
                    where usjo.what = 'begin EVENTI_ELIMINAZIONE; end;';
                    if v_esiste = 0 then
                    DBMS_JOB.submit(job            => d_job,
                    what           => 'begin EVENTI_ELIMINAZIONE; end;',
                    next_date      => trunc(sysdate +1) + 2/24,
                    interval       => 'trunc(sysdate +1) + 2/24',
                    no_parse       => TRUE
                    );

                    end if;
                    COMMIT;
                    end;
                    /
            </sql>
    </changeSet>
</databaseChangeLog>